# Home Assistant Add-on: ONNX ASR

Локальный сервер распознавания речи (STT) для Home Assistant на базе [ONNX ASR](https://github.com/istupakov/onnx-asr).

## Как использовать

После установки выбрать подходящую модель и запустить аддон. Система может автоматически обнаружить новую службу для интеграции wyoming.
Если этого не произошло, используйте название контейнера для хоста и выбранный порт. Название находится на главной странице запущенного аддона и в адрессной строке.

[![Open your Home Assistant instance and start setting up a new integration.](https://my.home-assistant.io/badges/config_flow_start.svg)](https://my.home-assistant.io/redirect/config_flow_start/?domain=wyoming)

После этого вы сможете выбрать "ONNX ASR" в качестве STT в настройках голосовых ассистентов.

## Модели и хранение

При первом запуске с выбранной моделью аддон автоматически скачает ее из интернета. Модели сохраняются в папку `share` вашего Home Assistant. 
Особый интерес представляют модели GigaAM, как конкурент Whisper Large (см. сравнение на сайте onnx-asr), но с хорошим быстродействием даже на средних cpu.

**Путь хранения моделей:** `/share/onnxasr/.cache/`

## Конфигурация

### Опция: `model`

Выбор модели для распознавания речи. Модели отличаются размером, скоростью и точностью. Для русского актуальны `gigaam-v2-ctc` [900/240], `vosk-model-ru` [260/75], `vosk-model-small-ru` [90/25]. В скобках размеры для fp32 и int8. Для английского может быть интересна nemo-parakeet-ctc-0.6b int8 [620]. 

### Опция: `int8_quantization`

Выбор int8 квантизации модели. Влияет на размер моделии скорость работы. Доступно не для всех моделей.


### Опция: `device`

Устройство для вычислений:
-   **cpu**: Стандартный вариант, работает на любом устройстве.
-   **cuda**: **Внимание!** Не выбирать. функция поддерживается программой, но не работает в аддоне, так как в HAOS нет драйверов и библиотек. Запускайте оригинальный [сервер](https://github.com/mitrokun/wyoming_stt_onnxasr) на машине с onnxruntime-gpu, если есть необходимость.

### Опция: `debug`

Включает подробное логирование в журнале аддона. Полезно для диагностики проблем.
